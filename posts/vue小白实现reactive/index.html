<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#494f5c"><meta name=msapplication-TileColor content="#494f5c"><meta itemprop=name content="Vue小白实现reactive"><meta itemprop=description content="After reading es5, es6, and ts, ok, it is time to read the Vue. So,git clone the source code ,then open it. WTF,every single word i understood, but, you know,i gave up.
All paths lead to Rome,as a newbie, what i can do is to write some sample myself.The easiest part of Vue may be the reactive function.So, let&rsquo;s get rid of it.
//The core concept of reactive is when we change the data, //the view can update simultaneously."><meta itemprop=datePublished content="2020-05-23T10:26:19+08:00"><meta itemprop=dateModified content="2020-05-23T10:26:19+08:00"><meta itemprop=wordCount content="619"><meta itemprop=keywords content="[es6 Vue reactive],"><meta property="og:title" content="Vue小白实现reactive"><meta property="og:description" content="After reading es5, es6, and ts, ok, it is time to read the Vue. So,git clone the source code ,then open it. WTF,every single word i understood, but, you know,i gave up.
All paths lead to Rome,as a newbie, what i can do is to write some sample myself.The easiest part of Vue may be the reactive function.So, let&rsquo;s get rid of it.
//The core concept of reactive is when we change the data, //the view can update simultaneously."><meta property="og:type" content="article"><meta property="og:url" content="https://zhang-fork.github.io/posts/vue%E5%B0%8F%E7%99%BD%E5%AE%9E%E7%8E%B0reactive/"><meta property="article:published_time" content="2020-05-23T10:26:19+08:00"><meta property="article:modified_time" content="2020-05-23T10:26:19+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vue小白实现reactive"><meta name=twitter:description content="After reading es5, es6, and ts, ok, it is time to read the Vue. So,git clone the source code ,then open it. WTF,every single word i understood, but, you know,i gave up.
All paths lead to Rome,as a newbie, what i can do is to write some sample myself.The easiest part of Vue may be the reactive function.So, let&rsquo;s get rid of it.
//The core concept of reactive is when we change the data, //the view can update simultaneously."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Vue小白实现reactive</title><link rel=stylesheet href=https://zhang-fork.github.io/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://zhang-fork.github.io>zhangFork</a></div><nav class="site-nav hide-in-mobile"><a href=https://zhang-fork.github.io/posts/>Posts</a>
<a href=https://zhang-fork.github.io/about-hugo/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://twitter.com/ target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://github.com/zhang-fork/ target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn title=Menu><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://zhang-fork.github.io/posts/>Posts</a></li><li><a href=https://zhang-fork.github.io/about-hugo/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>May 23, 2020</span></div><h1>Vue小白实现reactive</h1></header><div class=content><p>After reading <a href=https://wangdoc.com/javascript/>es5</a>, <a href=https://es6.ruanyifeng.com/>es6</a>, and <a href=https://ts.xcatliu.com/>ts</a>, ok, it is time to read the Vue. So,git clone the source code ,then open it.
<del>WTF</del>,every single word i understood, but, you know,i gave up.</p><p>All paths lead to Rome,as a newbie, what i can do is to write some sample myself.The easiest part of Vue may be the reactive function.So, let&rsquo;s get rid of it.</p><div class=highlight><pre class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=c1>//The core concept of reactive is when we change the data,
</span><span class=c1>//the view can update simultaneously.
</span><span class=c1>//Of course,the javaScript do not do this automatically,
</span><span class=c1>//when we change the data of an variable, just change it, nothing happen.
</span><span class=c1>//Luckily,we can solve this by the proxy API in es6.
</span><span class=c1></span><span class=kd>function</span> <span class=nx>reactive</span><span class=p>(</span><span class=nx>object</span><span class=p>){</span>
  <span class=k>if</span><span class=p>(</span><span class=nx>object</span> <span class=o>!==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>object</span> <span class=o>==</span> <span class=s2>&#34;object&#34;</span><span class=p>){</span>
    <span class=k>return</span> <span class=nx>makereactive</span><span class=p>(</span><span class=nx>object</span><span class=p>)</span>
  <span class=p>}</span><span class=k>else</span><span class=p>{</span>
    <span class=k>return</span> <span class=nx>object</span>
  <span class=p>}</span>
<span class=p>}</span>
<span class=kd>function</span> <span class=nx>makereactive</span><span class=p>(</span><span class=nx>object</span><span class=p>){</span>
  <span class=k>return</span> <span class=k>new</span> <span class=nb>Proxy</span><span class=p>(</span><span class=nx>object</span><span class=p>,</span><span class=nx>handler</span><span class=p>)</span>
<span class=p>}</span>
<span class=kd>let</span> <span class=nx>handler</span><span class=o>=</span><span class=p>{</span>
  <span class=nx>get</span><span class=p>(</span><span class=nx>target</span><span class=p>,</span><span class=nx>key</span><span class=p>,</span><span class=nx>receiver</span><span class=p>){</span>
    <span class=c1>//we can do what we want do here!
</span><span class=c1></span>    <span class=kd>let</span> <span class=nx>res</span><span class=o>=</span><span class=nx>Reflect</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>target</span><span class=p>,</span><span class=nx>key</span><span class=p>,</span><span class=nx>receiver</span><span class=p>)</span>
    <span class=k>return</span> <span class=nx>res</span>
    <span class=p>}</span>
  <span class=c1>//ok, you can add other handlers you need ,do it yourself.
</span><span class=c1></span><span class=p>}</span>

</code></pre></div><p>At this stage , problems below should be solved:</p><ul><li>how to make a nested object reactive</li><li>if we use the method of array,the handlers such as getting may be triggered more than once.</li><li>some other problems we don&rsquo;t know, you are the newbie!</li></ul><hr><h2 id=function-reactive>Function Reactive<a href=#function-reactive class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Ok,let&rsquo;s assume that all problems above had been solved,how about function?</p><p>As we know,the procedure ,such as joining or splitting the string,whatever,can also change the date.if we change the string, the returns of function must be changed too.how to implement this?</p><p>Simplified answer:if we change the object involved in the function, we recall this function.</p><p>Does JS can remember which function should be recalled when we change the object ?</p><p>Of course not,we have to construct a container to remember this,which store the object and the function ,what&rsquo;s more,this object may have many properties,our function may only related one of them,or many other properties too.</p><p>what a mess,whatever, let&rsquo;s call it verybigmap.</p><div class=highlight><pre class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=kd>let</span> <span class=nx>verybigmap</span><span class=o>=</span> <span class=k>new</span> <span class=nx>WeakMap</span><span class=p>();</span>
</code></pre></div><ul><li>The key is that when we call a function, we want verybigmap to remember and then we change the object ,call it again the handler getter must be triggered. Obviously,we should implant our code in handler.</li></ul><div class=highlight><pre class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=kd>let</span> <span class=nx>handler</span><span class=o>=</span><span class=p>{</span>
  <span class=nx>get</span><span class=p>(</span><span class=nx>target</span><span class=p>,</span><span class=nx>key</span><span class=p>,</span><span class=nx>receiver</span><span class=p>){</span>
    <span class=nx>track</span><span class=p>(</span><span class=nx>target</span><span class=p>,</span><span class=nx>key</span><span class=p>)</span><span class=c1>//track is a function that throw target and key into verybigmap
</span><span class=c1></span>    <span class=p>...</span>
  <span class=p>}</span>
<span class=p>}</span>

</code></pre></div><p>And then we make the function reactive</p><div class=highlight><pre class=chroma><code class=language-JavaScript data-lang=JavaScript><span class=nx>effect</span><span class=p>(</span><span class=nx>fn</span><span class=p>){</span>
  <span class=c1>//1,throw the fn to verybigmap
</span><span class=c1></span>  <span class=c1>//2,run fn to trigger the track function
</span><span class=c1></span>  <span class=c1>//which one be first?
</span><span class=c1></span><span class=p>}</span>
<span class=c1>//I think this name &#39;effect&#39; get from the terminology `side effect`
</span></code></pre></div><p>The problem in above code segments may be not a problem for experts,but no one forbid me to have a question.if we throw the fn to the verybigmap first,where we place it,the <em>key</em>,or the <em>value</em>?</p><p>Leaving it aside first,our aim is,after we trigger the setter(change a data),we recall the function,right? At first ,we must find the function in the verybigmap, at that moment, what we know is the target and the key(from the setter handler). Let&rsquo;s go back to previous problem, the answer is easy, fn must be the value. Yet hard question followed, how can we place a value in a map before we get a key?</p><p>It looks like we should run fn first,nevertheless,from the context of effect function,we can not get the key connected to fn.</p><p>There must be some kind of bridge to connect the target with fn,regardless of which one run first.you the wise must know that we can use the same trick again,when we run one step, push the key or value in stack,when we run the second procedure,we get the key or value from the stack top,then pop it.wow,there we go,fix it.</p><p>This article cost me a little time,I am so tired,the rest will be in next <a href>post</a>.</p><p>To be continued&mldr;</p></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://zhang-fork.github.io/tags/>[es6 Vue reactive]</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>619 Words</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-05-23 02:26 +0000</p></footer></article><div class="post-nav thin"><a class=next-post href=https://zhang-fork.github.io/posts/vue%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>&nbsp;Newer</span><br><span>Vue实现一个简单的评论系统</span></a>
<a class=prev-post href=https://zhang-fork.github.io/posts/slowing/><span class=post-nav-label>Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span><br><span>Slowing</span></a></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=https://zhang-fork.github.io>zhangFork</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://zhang-fork.github.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://zhang-fork.github.io/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-162836919-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>